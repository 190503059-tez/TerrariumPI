<div class="modal fade" tabindex="-1" role="dialog" id="modal-confirm">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">{{ _('Confirm') }}</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="{{ _('Close') }}">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p></p>
      </div>
      <div class="modal-footer justify-content-between">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">{{ _('Close') }}</button>
        <button type="button" class="btn btn-danger">
          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
          {{ _('Confirm') }}
        </button>
      </div>
    </div>
  </div>
</div>

{% include 'modals/area.html' %}

{% include 'modals/button.html' %}

{% include 'modals/enclosure.html' %}

{% include 'modals/event.html' %}

{% include 'modals/message.html' %}

{% include 'modals/playlist.html' %}

{% include 'modals/relay.html' %}

{% include 'modals/sensor.html' %}

{% include 'modals/service.html' %}

{% include 'modals/weather.html' %}

{% include 'modals/webcam.html' %}

<script type="text/javascript">
  jQuery(function(){
    jQuery('#modal-confirm').on('show.bs.modal',function(event) {

      let modal   = jQuery(event.currentTarget);
      let trigger = jQuery(event.relatedTarget);
      let action  = trigger.data('action');
      let url     = trigger.attr('href');
      let title   = trigger.attr('title');
      let reload  = trigger.data('reload') || true;
      let payload = {}

      modal.find('span.spinner-border').hide();

      if (trigger.data('field')) {
        payload[trigger.data('field')] = trigger.attr('id');
      }

      modal.find('div.modal-body p').html(title);
      modal.find('button.btn-danger').off('click').on('click',function() {
        modal.find('span.spinner-border').show();
        jQuery.ajax({
          type: action,
          url: url,
          data: JSON.stringify(payload),
          processData: false,
          contentType: 'application/json;charset=UTF-8',
          dataType:'json',
          cache: false,
          success: function (data) {
            let reload_url = data.location || false;
            let message = data.message || '{{ _('Action succeeded') }}';

            modal.modal('hide');
            toastr.success(message, 'OK');

            if (reload_url) {
              setTimeout(function(){
                window.location.href = reload_url;
              },2000)
            } else if (reload) {
              load_page();
            }
          },
          error: function (error) {
            toastr.error('Error:<br />' + error.responseJSON.message , 'ERROR');
          }
        });
      });
    });
  });
</script>